<%= content_for :head do %>
  <script type="text/javascript">

Navarra.pois.supplier_map ='<%= supplier_map_name(); %>' ; 
<% if @poi.the_geom %>

Navarra.pois.config.lat = <%= @poi.the_geom.y %>
Navarra.pois.config.lon = <%= @poi.the_geom.x %>
<% end %>

<% if @poi.original_object and @poi.original_object.the_geom %>
  Navarra.pois.config.originalLat = <%= @poi.original_object.the_geom.y %>;
  Navarra.pois.config.originalLon = <%= @poi.original_object.the_geom.x %>;
<% end %>
  </script>
<% end  %>

<%= simple_form_for @poi, :html => { :class => 'form-inline', :id => 'poi-form' } do |f| %>

  <%= f.hidden_field :longitude %>
  <%= f.hidden_field :latitude %>
  <div class="row-fluid">
    <div id="possible_duplicates" class="span12">
    </div>
  </div>
  <div class="row-fluid">

    <div class="span7">
      <%= field_set_tag t("views.poi.form.fieldsets.location") do %>
        <%= f.input :city_id, :collection => city_for_chosen(@poi.city_id), hint: poi_hint(:city_complete_name), input_html: {class: "span8"} %>
        <%= f.input :street_type_id, :collection => street_types_for_select, hint: poi_hint(:street_type_name) %>
        <%= f.input :poi_type_id, :collection => poi_types_for_select, hint: poi_hint(:poi_type_name) %>
        <%= f.input :street_name, hint: poi_hint(:street_name) %>
        <%= f.input :house_number, hint: poi_hint(:house_number) %>
        <div class="span3">
          <%= link_to t("views.poi.form.buttons.suggest_location"), "#", :class => 'btn', :id => 'suggest-locations-btn' %>
        </div>
        <div class="row-fluid">
          <div class="span3">
            <%= link_to t("views.poi.form.buttons.add_location"), "#", :class => 'btn', :id => 'add-marker-btn' %>
          </div>

        <% end %>
        </div>
        <div >
          <div class="row-fluid">
            <%= maps() %>
          </div>
          <div id="table-date">
            <table id= "datass" class="table">
            </table>
          </div>
        </div>
        <div class="span6">
          <% if params[:action] != 'new' && params[:action] != 'create' %>
            <div class="row">
              <div class="span4">
                <%= f.input :identifier,  readonly: true, as: :string %>
              </div>
              <div class="span4">
                <%= f.input :duplicated_identifier, as: :string  %>
              </div>      
              <div class="span4">
                <%= f.input :old_identifier,  readonly: true, as: :string %>
              </div>
            </div>
            <div class="row">
              <% if current_user.role == 'Admin' %>
                <div class="span4">
                  <%=f.input :user_id, collection: User.order(:name), selected: @poi.user_id || current_user.id   %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
        <div class="span6">
          <%= field_set_tag t("views.poi.form.fieldsets.poi") do %>
            <div class="span6">
              <%= f.input :chain_id, :collection => poi_type_chains_for_select, hint: poi_hint(:chain_name)%>
              <%= f.input :name, hint: poi_hint(:name) %>
              <%= f.input :food_type_id, :collection => poi_type_food_types_for_select(@poi.poi_type_id), hint: poi_hint(:food_type_name) %>
            </div>
            <div class="span2">
              <%= f.input :poi_sub_type_id, :collection => poi_type_sub_types_for_select(@poi.poi_type_id), hint: poi_hint(:poi_sub_type_name) %>
            
              <div class="restaurant_types">
                <%= f.input :restaurant_type_id, :collection => poi_restaurant_types_for_select, hint: poi_hint(:poi_sub_type_name) %>
              </div>
            </div>      
          <% end %>
        </div>      
        <div class="span6">
          <%= field_set_tag t("views.poi.form.fieldsets.contact") do %>
            <div class="span6">

              <%= f.input :phone, hint: poi_hint(:phone) %>
              <%= f.input :second_phone, hint: poi_hint(:second_phone) %>
              <%= f.input :fax, hint: poi_hint(:fax) %>
              <%= f.input :cel_number, hint: poi_hint(:cel_number) %>
              <%= f.input :internal_observation, as: :text %>
            </div>
            <div class="span2">
              <%= f.input :email, hint: poi_hint(:email) %>
              <%= f.input :second_email, hint: poi_hint(:second_email) %>
              <%= f.input :website, hint: poi_hint(:website) %>
              <%= f.input :note, as: :text, hint: poi_hint(:note) %>
            </div>

          <% end %>
        </div>  

        <% if params[:action] != 'new' && params[:action] != 'create' %>
          <div class="span6">
            <%= field_set_tag t("views.poi.form.fieldsets.poi_action") do %>
              <div class="span3">
                <%= f.association :p_action  %>
              </div>
              <div class="span3">
                <%= f.input :control_date, as: :hidden %>
                <%= f.input :poi_status_id, as: :hidden %>
              </div>
            <% end %>
          </div>
        <% end %>

    </div>
    <div class="form-actions">
      <% if @poi.poi_status_id != 5 %>
        <%= f.button :submit, :class => 'btn-primary', data: {disable_with: "Enviando"}%>
        <%= link_to t('.cancel', :default => t("helpers.links.cancel")), pois_path, :class => 'btn' %>
      <% end  %>
    </div>
  <% end %>
