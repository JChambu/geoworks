// Levanta los datos
heatmap_indicator = '<%= params[:q][:project_kpi] %>';
field =  "<%=  get_name_from_key().name  %>";

// Carga las variables globales
Navarra.project_types.config.heatmap_field = field;
Navarra.project_types.config.heatmap_indicator = heatmap_indicator;

// Elimina el modal
$("#heatmap-modal").remove();
$('.modal-backdrop').remove();

// Elimina y vuelve a agregar el item al card Filtros Activos
$("#heatmap_filter").remove();
$('#filter-body').append(
  $('<div>', {
    'class': 'text-light bg-secondary px-2 mb-1 py-1 rounded border border-dark shadow',
    'id': 'heatmap_filter',
  }).append(
    $('<b>', {
      'text': 'Mapa de Calor por: '+field
    }),
    $('<button>', {
      'type': 'button',
      'class': 'close',
      'id': 'close_heatmap_filter',
      'text': '×'
    })
  )
)

// Activa el icono
$(".fa-fire").css("color", "#d3d800");

// Lanza la función
Navarra.geomaps.heatmap_data();
